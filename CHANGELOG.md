# Fediverse Sync for Typecho - 更新日志

## 版本 1.6.2 (2025-12-19)

### 行为调整
- 移除数据库日志表写入：不再写入 `{前缀}fediverse_sync_logs`
- 日志改为写入 `usr/logs/fediverse-sync.log`（错误日志始终记录，调试模式记录更多信息）

## 版本 1.6.1 (2025-12-19)

### 行为调整
- 移除“同步时显示原文内容”配置项：是否包含原文内容改为由同步内容模板是否包含 `{content}` 决定
- “原文内容长度限制”仅在模板包含 `{content}` 时生效

### 修复问题
- 修复部分场景下同步消息无法带入正文内容的问题（发布同步 / 手动同步 / API 同步）
- 修复 SQLite 环境下启用插件时，建表检测查询 `information_schema` 导致的报错

## 版本 1.6.0 (2024-01-15)

### 新增功能
- **自定义同步内容模板**
  - 支持6个模板变量：{title}、{permalink}、{content}、{author}、{created}、{site_name}
  - 可完全自定义同步到Fediverse的消息格式
  - 模板验证功能，确保变量使用正确

- **原文内容显示选项**
  - 新增"同步时显示原文内容"配置选项
  - 可设置原文内容长度限制（0表示不限制）
  - 自动去除HTML标签并格式化内容

- **后台管理界面优化**
  - 新增同步配置信息预览面板
  - 显示当前实例类型、可见性、模板等配置
  - 提供模板变量使用说明
  - 美化界面样式，提升用户体验

### 代码优化
- **模块化架构**
  - 新增 `Utils/Template.php` 模板工具类
  - 统一处理模板解析、内容处理、变量验证
  - 提高代码复用性和可维护性

- **改进的内容处理**
  - 智能HTML标签去除
  - 空白字符规范化处理
  - 内容长度智能截断

- **同步逻辑优化**
  - 所有同步入口统一使用模板系统
  - 支持自动同步和手动同步两种模式
  - 改进错误处理和日志记录

### 文件结构优化
```
FediverseSync/
├── Plugin.php              # 主插件文件（新增模板配置）
├── Action.php              # 手动同步操作（集成模板系统）
├── Api/Sync.php            # API同步功能（集成模板系统）
├── panel.php               # 后台面板（新增配置预览）
├── Models/Binding.php      # 数据模型（保持不变）
├── Utils/
│   ├── Http.php            # HTTP请求工具（保持不变）
│   └── Template.php        # 新增模板工具类
└── README.md               # 更新文档说明
```

### 使用示例

#### 默认模板
```
「{title}」

{permalink}

From「{site_name}」
```

#### 自定义模板示例
```
📢 {site_name} 发布了新文章「{title}」

{content}

👉 {permalink}

作者：{author} | {created}
```

#### 简洁模板
```
新文章：{title} {permalink}
```

### 兼容性
- 完全向后兼容，升级不会影响现有功能
- 默认配置保持原有行为
- 新功能均为可选配置

### 修复问题
- 优化了内容处理的性能
- 改进了错误处理机制
- 增强了代码的可读性和可维护性
